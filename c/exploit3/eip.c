#define _GNU_SOURCE

#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <string.h>

struct vulnerable {
	char buffer [128];
	void (*fp)(void);
};

void shell (void) {
	printf("%s\n", "Good job, getting your shell...");
	gid_t gid = getegid();
	setresgid(gid, gid, gid);
	system("/bin/sh -i");
}

void failure (void) {
	printf("%s\n", "Sorry, try again...");
	exit(0);
}

int main (int argc, char **argv) {

	struct vulnerable vuln;
	vuln.fp = &failure;

	printf ("%s\n\t%s\n\t%s\n\n%s",
		"Welcome to DC612 1-Day event!",
		"Stack Overflow Lvl 0",
		"Simple variable alteration wins this one!",
		"Input: ");

	gets(vuln.buffer);
	vuln.fp();
	exit(1);
}
