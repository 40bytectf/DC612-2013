#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <string.h>

struct vulnerable {
        char overwrite[24];
        char test[6];
        char buffer[128];
}

int main (int argc, char **argv) {

	struct vulnerable vuln;
	strncpy(vuln.test, "12345\0", sizeof(vuln.test));
	strncpy(vuln.overwrite, "DC612 Day\0", sizeof(vuln.overwrite));

        printf ("%s\n\t%s\n\t%s\n\n%s ",
		"Welcome to DC612 1-Day event!",
		"Stack Overflow Lvl 3",
		"Continue to overflow buffers, but be wary to keep existing data!"
		"Input:");

        gets(buffer);

        if (!strncmp(overwrite, "DC612 Day\0", 9)) {
                printf("%s\n", "Sorry try again...");
                exit(1);
        }
        if (strncmp(test, "12345\0", 5)) {
                printf("%s\n%s\n",
			"Sorry, remeber to watch for other variables"
			"Just filling the buffer will not work here");
                exit(1);
	} else {
		gid_t gid = getegid();
		setresgid(gid, gid, gid);
		system("/bin/sh -i");
	}

	return 0;

}
