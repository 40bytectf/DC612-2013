#define _GNU_SOURCE

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <fcntl.h>
#include <unistd.h>

struct vulnerable{
	int compare;
	char buffer[128];
	char overwrite[24];
};

int main (int argc, char **argv) {

	struct vulnerable vuln;
	vuln.compare = 9;
	strncpy(vuln.overwrite, "DC612 Day\0", vuln.compare);

	printf("%s\n\t%s\n\t%s\n",
		"Welcome to DC612 1-Day event!",
		"Stack Overflow Lvl 0",
		"Simple variable alteration wins this one!");

	gets(vuln.buffer);

	if (!strncmp(vuln.overwrite, "DC612 Day", vuln.compare)) {
		printf("%s\n", "Sorry try again...");
		exit(1);
	} else {
		printf("%s\n", "Good job, starting your shell...");
		gid_t gid = getegid();
		setresgid(gid, gid, gid);
		system("/bin/sh -i");
	}
	exit(0);
}
